<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../scripts/behaviors/busListenerBehavior.html">
<link rel="import" href="../../scripts/jquery.html">

<dom-module id="editor-toolbar">
  <template>

    <style>
      .buttons {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      .main-toolbar {
        z-index: 10;
      }

      .navbar-project-title {
        --paper-input-container-input-color: #FFFFFF;
        --paper-input-container-color: #FF5B81;
        --paper-input-container-focus-color: #FF5B81;
        width: 70%;
        margin-left: 15px;
      }
    </style>

    <paper-toolbar class="main-toolbar">
      <template is="dom-if" if="{{isNotEmpty(tools)}}">
        <paper-icon-button icon="menu" paper-drawer-toggle on-click="togglePanel"></paper-icon-button>
      </template>

      <img class="app-logo" src="../../images/logo.png" />
      <paper-input value="Acá va un nombre que describe qué es este proyecto" class="navbar-project-title" no-label-float>
        <paper-icon-button suffix icon="save"></paper-icon-button>
        <paper-icon-button suffix icon="folder-open"></paper-icon-button>
      </paper-input>

      <div class="title"></div>

      <template is="dom-if" if="{{isNotEmpty(tools)}}">
        <div class="buttons">
          <template is="dom-if" if="{{showZoom(tools)}}">
            <paper-button on-click="increaseEditorFontSize"><iron-icon class="button" icon="icons:zoom-in"></iron-icon></paper-button>
            <paper-button on-click="decreaseEditorFontSize"><iron-icon class="button" icon="icons:zoom-out"></iron-icon></paper-button>
          </template>
          <template is="dom-if" if="{{permissions.can_use_library}}">
            <paper-button on-click="toggleLibrary"><iron-icon class$="button {{buttonCssClass(showLibrary)}}" icon="icons:chrome-reader-mode"></iron-icon></paper-button>
          </template>
          <paper-button on-click="toggleShowBoards"><iron-icon class="button" icon$="icons:chevron-{{_showBoardsDirection(showBoards)}}"></iron-icon></paper-button>
        </div>
      </template>
    </paper-toolbar>

  </template>

  <script>

    Polymer({
      is: 'editor-toolbar',
      behaviors: [
        Polymer.BusListenerBehavior,
        Polymer.LeftMenuBehavior
      ],
      properties: {
        tools: {
          type: String,
          value: "none"
        },
        showBoards: {
          type: Boolean,
          value: true
        },
        showLibrary: {
          type: Boolean,
          value: false
        },
        permissions: {
          type: Object,
          value: { can_use_library: true }
        }
      },

      ready: function() {
        if (this.empty) return;

        this.subscribeTo("mode-change", mode => {
          this.showLibrary = mode === "library";
        }).subscribeTo("reset", () => {
          this.set("permissions.can_use_library", true);
        });
      },

      attached: function() {
        this.setUpLoaders({
          Project: new ProjectLoader
        });
      },

      togglePanel: function() {
        $("paper-drawer-panel")[0].togglePanel();
      },

      toggleShowBoards: function() {
        this.showBoards = !this.showBoards;
        this.fire("show-boards-changed", this.showBoards);
      },

      toggleLibrary: function() {
        if (window.GBS_IS_RUNNING) return;
        this._editor().toggleMode();
      },

      buttonCssClass: function(element) {
        if (!this.domHost) return;
        return this.domHost.buttonCssClass(element);
      },

      increaseEditorFontSize: function() {
        this._editor().increaseFontSize();
      },

      decreaseEditorFontSize: function() {
        this._editor().decreaseFontSize();
      },

      showZoom: function(tools) {
        return tools === "code";
      },

      isNotEmpty: function(tools) {
        return tools !== "none";
      },

      _editor: function() {
        return document.querySelector("#editor");
      },

      _showBoardsDirection: function(value) {
        return value ? 'right' : 'left';
      }
    });

  </script>
</dom-module>
