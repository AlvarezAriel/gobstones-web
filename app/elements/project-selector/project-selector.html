<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../scripts/loaders/remote/guideLoader.html">

<dom-module id="project-selector">
  <style>
    .exercise {
      cursor: pointer;
      width: 300px;
      height: 300px;
      float: left;
      margin: 20px;
    }
  </style>

  <template>
    <h1>[[localize("select-an-exercise")]]</h1>

    <div class="container">
      <template is="dom-repeat" items="[[exercises]]">
        <div class="exercise">
          <a on-tap="goToExercise">
            <h3>[[item.name]]</h3>
            <img width="250px" height="250px" src="{{item.imageUrl}}" />
          </a>
        </div>
      </template>
    </div>
  </template>

  <script>

    Polymer({
      is: 'project-selector',
      behaviors: [
        Polymer.LocalizationBehavior
      ],
      properties: {
        exercises: {
          type: Array,
          value: []
        }
      },

      ready: function() {
        this.loadGuide();
      },

      // TODO: Deshardcodear guÃ­a
      loadGuide: function() {
        this.exercises = [];
        new GuideLoader("rodri042/gobstones-guide-test", "Proyectos/Cap.2").getExercises().then(exercises => {
          this.exercises = exercises;
          this._resizePopup();
        });
      },

      goToExercise: function(event) {
        this._ide().hideProjectSelectorModal();

        const exercise = event.model.item;

        this._goTo(
          `/blocks?github=rodri042/gobstones-guide-test&path=Proyectos/Cap.2/${exercise.name}`
        );
      },

      _ide() {
        return document.querySelector("#gobstones-ide");
      },

      _resizePopup() {
        document.querySelector("#projectSelectorModal").notifyResize();
      },

      _goTo: function(route) {
        return document.querySelector("app-router").go(route);
      }
    });

  </script>
</dom-module>
