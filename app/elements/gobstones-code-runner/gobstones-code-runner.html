<dom-module id="gobstones-code-runner">

  <template>
    <style>
    </style>

    <div>
      <paper-fab id="gbsPlayButton"
                 icon="av:play-arrow"
                 on-click="_onButtonClick"
      ></paper-fab>
    </div>
  </template>

  <script>
    // TODO: Mover a https://github.com/gobstones/gobstones-code-runner

    Polymer({
      is: 'gobstones-code-runner',

      properties: {
        isRunning: {
          type: Boolean,
          value: false,
          notify: true,
          observer: "_onUpdate"
        }
      },

      start: function(request) {
        this._checkRequiredProperties(request, ["initialBoard", "code", "targetBoard"]);
        if (this.isRunning) this.stop();

        const { initialBoard, code, targetBoard, runningSpeed = 3 } = request;
        // TODO: Run

        this.isRunning = true;
        this.fire("gbs-start");
      },

      stop: function(reason = "canceled") {
        this.isRunning = false;
        this.fire("gbs-stop", reason);
      },

      _onButtonClick: function() {
        if (!this.isRunning) {
          this.fire("gbs-run-request", {
            start: this.start.bind(this),
            stop: this.stop.bind(this)
          });
        } else {
          this.stop();
        }
      },

      _checkRequiredProperties: function(request, properties) {
        const missingProperties = _(request).keys().filter((it) => properties[it]).value();
        if (missingProperties.length > 0) {
          throw new Error(`Missing properties: ${missingProperties.join(", ")}`);
        }
      },

      _onUpdate: function() {
        this.$.gbsPlayButton.icon = this.isRunning ? "av:stop" : "av:play-arrow";
      }
    });
  </script>
