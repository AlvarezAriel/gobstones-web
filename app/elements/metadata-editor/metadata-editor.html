<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../scripts/simplemde.html">
<link rel="import" href="../../scripts/stylist.html">
<link rel="import" href="../../scripts/behaviors/busListenerBehavior.html">
<link rel="import" href="../../scripts/behaviors/permissionsBehavior.html">
<link rel="import" href="../../scripts/behaviors/localizationBehavior.html">

<dom-module id="metadata-editor">
  <template>
    <style>
      .menu-header-gobstones {
        background-color: white;
        font-weight: 800;
      }

      .metadata-editor-options {
        width: 100%;
        overflow: scroll;
        overflow-x: hidden;
      }

      .json-editor {
        height: 50vh;
      }
    </style>

    <div class="metadata-editor-options">
      <paper-item center-justified flex class="menu-header-gobstones">
        <div>[[localize("settings-library")]]</div>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-library-visible")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.library.visible}}"></paper-toggle-button>
      </paper-item>

      <paper-item center-justified flex class="menu-header-gobstones">
        <div>[[localize("settings-code")]]</div>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-code-visible")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.source.visible}}"></paper-toggle-button>
      </paper-item>

      <paper-item center-justified flex class="menu-header-gobstones">
        <div>[[localize("settings-boards")]]</div>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-boards-collapse-toolbox")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.board.collapse_toolbox}}"></paper-toggle-button>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-boards-visible-edition")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.board.visible_edition}}"></paper-toggle-button>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-boards-can-change-initial-board")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.board.user_permissions.can_change_initial_board}}"></paper-toggle-button>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-boards-can-edit-board")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.board.user_permissions.can_edit_board}}"></paper-toggle-button>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-boards-can-change-initial-board-source")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.board.user_permissions.can_change_initial_board_source}}"></paper-toggle-button>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-boards-can-view-size-section")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.board.user_permissions.can_view_size_section}}"></paper-toggle-button>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-boards-can-view-attire-section")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.board.user_permissions.can_view_attire_section}}"></paper-toggle-button>
      </paper-item>

      <paper-item center-justified flex class="menu-header-gobstones">
        <div>[[localize("settings-execution-speed")]]</div>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-execution-speed-can-change-speed")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.execution_speed.user_permissions.can_change_speed}}"></paper-toggle-button>
      </paper-item>

      <paper-item center-justified flex class="menu-header-gobstones">
        <div>[[localize("settings-attires")]]</div>
      </paper-item>

      <paper-item>
        <paper-item-body>
          <div>[[localize("settings-attires-can-toggle-visibility")]]</div>
        </paper-item-body>
        <paper-toggle-button checked="{{metadata.attire.user_permissions.can_toggle_visibility}}"></paper-toggle-button>
      </paper-item>

      <paper-item center-justified flex class="menu-header-gobstones">
        <div>[[localize("settings-blocks")]]</div>
      </paper-item>

      <juicy-jsoneditor
        class="json-editor"
        json="{{metadata.blocks}}"
        search="false"
      ></juicy-jsoneditor>
    </div>
  </template>

  <script>
    Polymer({
      is: 'metadata-editor',
      properties: {
        metadata: {
          type: Object,
          value: { }
        }
      },
      behaviors: [
        Polymer.BusListenerBehavior,
        Polymer.PermissionsBehavior,
        Polymer.LocalizationBehavior
      ],

      ready: function() {
        this.set("metadata", this._defaultMetadata());

        this.stylist = new Stylist();
        this.stylist.setUpMetadataEditorCustomizations();
      },

      getMetadata: function() {
        return this.metadata;
      },

      setMetadata: function(config) {
        this.metadata = config;
      },

      reset: function() {
        this.set("metadata", this._defaultMetadata());
      },

      _defaultMetadata() {
        return {
          library: {
            visible: true
          },
          source: {
            visible: true,
            percentage: 0.6,
          },
          board: {
            visible_edition: true,
            collapse_toolbox: false,
            user_permissions: {
              can_change_initial_board: true,
              can_change_initial_board_source: true,
              can_edit_board: true,
              can_view_size_section: true,
              can_view_attire_section: true
            }
          },
          execution_speed: {
            user_permissions: {
              can_change_speed: true
            }
          },
          attire: {
            user_permissions: {
              can_toggle_visibility: true
            }
          },
          blocks: {
            visible: [],
            disabled: []
          }
        };
      }
    });
  </script>
</dom-module>


